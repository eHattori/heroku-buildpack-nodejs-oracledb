#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

echo $BUILD_DIR
echo $ENV_DIR

indent() {
    echo "       $*" || true
}

VENDOR_DIR=$BUILD_DIR/vendor
ORACLE_DIR=$VENDOR_DIR/oracle
INSTANTCLIENT_DIR=$ORACLE_DIR/instantclient_12_1
PROFILE_D_DIR=$BUILD_DIR/.profile.d
MIRROR=https://github.com/eHattori/oracle-instant-client/archive/v1.0.0.zip


indent "Create Oracle Path..."
mkdir -p opt/oracle

indent "Download Instant Client..."
wget -q $MIRROR

indent "PWD..."
pwd



indent "Unzip client..."
unzip v1.0.0.zip

indent "LL..."
ls -lah

cd ./v1.0.0

unzip instantclient-basic-linux.x64-12.1.0.2.0.zip
unzip instantclient-sdk-linux.x64-12.1.0.2.0.zip
unzip instantclient-sqlplus-linux.x64-12.1.0.2.0.zip

indent "Move Instant Client..."
mv instantclient_12_1 instantclient
mv instantclient /opt/oracle

cd /opt/oracle

indent "Create Symbolic link..."
ln -s /opt/oracle/instantclient/libclntsh.so.12.1 /opt/oracle/instantclient/libclntsh.so
ln -s /opt/oracle/instantclient/libocci.so.12.1 /opt/oracle/instantclient/libocci.so

indent "Export ENV..."
export LD_LIBRARY_PATH="/opt/oracle/instantclient"
export OCI_HOME="/opt/oracle/instantclient"
export OCI_LIB_DIR="/opt/oracle/instantclient"
export OCI_INCLUDE_DIR="/opt/oracle/instantclient/sdk/include"


THIS_DIR=`pwd`

indent "Done."
